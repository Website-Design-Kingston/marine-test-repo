var MainService = (function () {
  'use strict';

  function Marine() {}


  Marine.prototype.init = function () {
    this.contentPopup();
    //this.forceLandscape(); // Uncomment this if you want to force the view to be landscape in portrait mode
    this.updateViewMode();
    this.setupEvent();
    this.updateCopyrightYear();
    this.browserDetect();
  };

  Marine.prototype.browserDetect = function () {
    var userAgent = window.navigator.userAgent;
    var msie = userAgent.indexOf('MSIE') !== -1;
    var ie11 = !!userAgent.match(/Trident.*rv\:11\./);
    var msEdge = userAgent.indexOf('Edge') !== -1;

    if (msie || ie11) {
      $('body').addClass('internet-explorer');
    }
    if (msEdge) {
      $('body').addClass('ms-edge');
    }
  };

  Marine.prototype.updateCopyrightYear = function () {
    var today = new Date();
    var copyrightYear = $('#page--copyright-year');

    if (copyrightYear) {
      copyrightYear.text(today.getFullYear());
    }
  };

  Marine.prototype.updateViewMode = function () {
    var windowWidth = $(window).width();
    var windowHeight = $(window).height();
    var windowClass = windowWidth > windowHeight ? 'landscape' : 'portrait';

    /* For screen like iphone x */
    if (windowWidth < windowHeight && windowWidth / windowHeight < 0.5) {
      windowClass += ' portrait-iphonex';
    }
    /* For screen like galaxy s */
    else if (windowWidth < windowHeight && windowWidth / windowHeight < 0.6) {
      windowClass += ' portrait-galaxys';
    }
    /* For square screen bb devices */
    else if (windowHeight / windowWidth > 0.9) {
      windowClass += ' portrait-bb';
    }

    $('body').removeClass('portrait landscape portrait-iphonex portrait-galaxys');
    $('body').addClass(windowClass);
  };

  Marine.prototype.forceLandscape = function () {
    var md = new MobileDetect(window.navigator.userAgent);
    if ((md.tablet() || md.mobile()) && ($("body.body--wreck-diver")[0])) {
      $('html').addClass('page-tablet');
    } else {
      $('html').removeClass('page-tablet');
    }
  };

  Marine.prototype.startPlayer = function () {
    var player = '#music-player';
    var playerContainer = '#music-player-container';
    var options = {
      ready: function () {
        $(this).jPlayer('setMedia', {
          title: '',
          mp3: './figures/audios/audio.mp3'
        });
        $(playerContainer).find('.jp-play').trigger('click');
      },
      swfPath: '../vendors/jplayer',
      supplied: 'mp3',
      cssSelectorAncestor: '#music-player-container',
      wmode: 'window',
    };
    $(player).jPlayer(options);
  };

  Marine.prototype.contentPopup = function () {
    var btnClose = '.content-popup .btn-close';
    if ($(btnClose).length) {
      $(btnClose).on('click', function (e) {
        e.preventDefault();

        $(this).parent().hide();
      });
    }
  };

  Marine.prototype.setupEvent = function () {
    $('.learn, .help').on('click', function () {
      $('.learn').removeClass('active');
      $('.help').removeClass('active');
      $(this).addClass('active');
    });

    $('.learn-popup .btn-close, .help-popup .btn-close').on('click', function () {
      $('.learn').removeClass('active');
      $('.help').removeClass('active');
    });

    $('header .sub-header .menu').on('click', function () {
      $(' > ul', this).toggleClass('active');
    });

    $(document).on('keypress', '*', function (e) {
      var keyCode = e.charCode ? e.charCode : e.keyCode ? e.keyCode : 0;
      if (keyCode === 13) {
        e.preventDefault();
        $(this)[0].click();
      }
    });
  };

  $(document).ready(function () {
    var marine = new Marine();
    marine.init();
  });

  $(window).resize(function () {
    var marine = marine || new Marine();
    marine.updateViewMode();
  });

  return {
    initAudio: initAudio,
    stopAudio: stopAudio,
    startAudio: startAudio
  };

  function initAudio() {
    var player = '#music-player';
    var options = {
      ready: function () {
        $(this).jPlayer('setMedia', {
          title: '',
          mp3: './figures/audios/audio.mp3'
        });
      },
      swfPath: '../vendors/jplayer',
      supplied: 'mp3',
      cssSelectorAncestor: '#music-player-container',
      wmode: 'window',
      loop: true
    };
    $(player).jPlayer(options);
  }

  function stopAudio() {
    $('#music-player-container').find('.jp-pause').trigger('click');
  }

  function startAudio() {
    setTimeout(function () {
      $('#music-player-container').find('.jp-play').trigger('click');
    }, 1000);
  }
})();